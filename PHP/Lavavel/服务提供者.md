# 服务提供者
Laravel中核心服务及开发者的应用程序都是通过服务提供者启动，即服务提供者会注册应用程序所要用到类库，包括注册服务容器绑定、事件监听器、过滤器，甚至路由。

##例子
所有的服务提供者类都应该继承Illuminate\Support\ServiceProvider，并且至少实现register方法。在该方法中应该只做服务绑定，不做注册事件监听、路由或其他功能。

可通过artisan快速创建服务提供者类文件：

```shell
php artisan make:provider RiakServiceProvider
```

###register方法

```shell
<?php namespace App\Providers;

use Riak\Connection;
use Illuminate\Support\ServiceProvider;

class RiakServiceProvider extends ServiceProvider {

    /**
     * 在容器中注册绑定。
     *
     * @return void
     */
    public function register()
    {
        $this->app->singleton('Riak\Contracts\Connection', function($app)
        {
            return new Connection($app['config']['riak']);
        });
    }

}
```

> 此类位于 App\Providers 命名空间之下，因为这是 Laravel 中默认服务提供者所在的位置。然而，你可以随自己的需要改变它。你的服务提供者可被置于任何 Composer 能自动加载的位置。

###boot方法
在服务提供者中实现boot方法，这个方法会在所有的服务提供者注册后才被调用。
可以在这个方法中添加事件监听等操作:

```php
<?php namespace App\Providers;

use Event;
use Illuminate\Support\ServiceProvider;

class EventServiceProvider extends ServiceProvider {

    /**
     * 执行注册后的启动服务。
     *
     * @return void
     */
    public function boot() {
        Event::listen('SomeEvent', 'SomeEventHandler');
    }

    /**
     * 在容器中注册绑定。
     *
     * @return void
     */
    public function register() {
        //
    }

}
```
也可以对boot中的依赖做类型提示，服务容器会自动注入该依赖

```php
use Illuminate\Contracts\Events\Dispatcher;

public function boot(Dispatcher $events) {
    $events->listen('SomeEvent', 'SomeEventHandler');
}
```

##注册服务提供者
config/app.php

```php
/*
    |--------------------------------------------------------------------------
    | Autoloaded Service Providers
    |--------------------------------------------------------------------------
    |
    | The service providers listed here will be automatically loaded on the
    | request to your application. Feel free to add your own services to
    | this array to grant expanded functionality to your applications.
    |
    */

    'providers' => [

        /*
         * Laravel Framework Service Providers...
         */
        Illuminate\Auth\AuthServiceProvider::class,
        Illuminate\Broadcasting\BroadcastServiceProvider::class,
        Illuminate\Bus\BusServiceProvider::class,
        Illuminate\Cache\CacheServiceProvider::class,
        
        
        /*
         * Application Service Providers...
         */
        App\Providers\AppServiceProvider::class,
        App\Providers\AuthServiceProvider::class,
        App\Providers\EventServiceProvider::class,
        App\Providers\RouteServiceProvider::class,
     ],
```

##缓载提供者
若你的提供者仅仅用于绑定注册到服务容器，你可以选择延缓其注册，直到真正需要其中注册的绑定才加载。延缓像这样的提供者加载可增进应用程序的性能，因为这样就不用每个请求都从文件系统中将其加载。

要延缓提供者加载，将 defer 性质设为 true，并定义一个 provides 方法。 provides 方法应返回提供者所注册的服务容器绑定。

```php
<?php namespace App\Providers;

use Riak\Connection;
use Illuminate\Support\ServiceProvider;

class RiakServiceProvider extends ServiceProvider {

    /**
     * 指定是否延缓提供者加载。
     *
     * @var bool
     */
    protected $defer = true;

    /**
     * 注册服务提供者。
     *
     * @return void
     */
    public function register()
    {
        $this->app->singleton('Riak\Contracts\Connection', function($app)
        {
            return new Connection($app['config']['riak']);
        });
    }

    /**
     * 取得提供者所提供的服务。
     *
     * @return array
     */
    public function provides()
    {
        return ['Riak\Contracts\Connection'];
    }

}
```

Laravel 编译并保存所有由延缓服务提供者所提供的服务清单，以及其服务提供者的类名称。只有在当你尝试解析其中的服务时， Laravel 才会加载服务提供者


