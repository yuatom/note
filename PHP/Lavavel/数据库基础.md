# 数据库基础
##配置
读写主机分别配置，如果`read`或`write`元素中有配置其他选项，则使用该选项的配置，否则则使用与`read`或`write`同级的配置：

```php
'mysql' => [
    'read' => [
        'host' => '192.168.1.1',
    ],
    'write' => [
        'host' => '196.168.1.2'
    ],
    'driver'    => 'mysql',
    'database'  => 'database',
    'username'  => 'root',
    'password'  => '',
    'charset'   => 'utf8',
    'collation' => 'utf8_unicode_ci',
    'prefix'    => '',
],
```

##执行原生sql
要执行原生的sql语句，可只用DB Facade的方法：`select`, `update`,`insert`, `delete`, 和`statement`：

```php
// select查询，第一个参数是sql，第二个参数绑定的参数
$users = DB::select('select * from users where active = ?', [1]);	// 使用?绑定
$results = DB::select('select * from users where id = :id', ['id' => 1]);	// 命名绑定
// 返回对象结果集
foreach ($users as $user) {
    echo $user->name;
}

// insert
DB::insert('insert into users (id, name) values (?, ?)', [1, 'Dayle']);

// update，返回受更新语句影响的行数
$affected = DB::update('update users set votes = 100 where name = ?', ['John']);

// delete，返回删除的行数
$deleted = DB::delete('delete from users');

// 执行sql语句
DB::statement('drop table users');
```

##绑定监听事件
监听每次sql的执行，可以用来做日志记录，使用`listen`方法：

```php
<?php

namespace App\Providers;

use DB;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider{
    /**
     * 启动所有应用服务
     *
     * @return void
     */
    public function boot()
    {
        DB::listen(function($sql, $bindings, $time) {
            //
        });
    }

    /**
     * 注册服务提供者
     *
     * @return void
     */
    public function register()
    {
        //
    }
}
```

##事务

```php
// 自动回滚或提交
DB::transaction(function () {
    DB::table('users')->update(['votes' => 1]);
    DB::table('posts')->delete();
});

// 手动
DB::beginTransaction();
DB::rollBack();
DB::commit();
```

##多个数据库连接
在`config/database.php`配置多个数据库的连接参数，然后在执行sql时选择要使用的连接

```php
$users = DB::connection('foo')->select(...);
```

