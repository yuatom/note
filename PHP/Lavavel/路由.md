# 路由
##定义路由
在app/Http/routes.php中

```php
// GET请求访问host/index.php，加载welcome页面
Route::get('/', function () {
    return view('welcome');
});

// GET请求访问host/index.php/hello时，返回Hello World
Route::get('/hello', function () {
    return 'Hello World';
});

// POST，请求
Route::post('foo/bar', function(){
    return 'Hello World';
});

// 多种请求
Route::match(['get', 'post'], '/', function(){
    return 'Hello World';
});

// 所有类型请求
Route::any('foo', function(){
    return 'Hello World';
});
```

##路由参数

```php
// 必须的参数
Route::get('user/{id}', function($id){
    return 'User '.$id;
});

// 非必须
Route::get('user/{name?}', function($name = null){	// null可改为其他默认值
    return $name;
});

// 使用正则限制参数
Route::get('user/{name}', function($name){
    //
})
->where('name', '[A-Za-z]+');

// 使用数组限制
Route::get('user/{id}/{name}', function($id, $name){
    //
})
->where(['id' => '[0-9]+', 'name' => '[a-z]+']);

// 全局参数限制
// 在RouteServiceProvider的boot方法中定义，即所有的带id参数的请求都要求id是数字
$router->pattern('id', '[0-9]+');
```

##获取参数

```php
// 在路由外部
if ($route->input('id') == 1){
    //
}

//在定义路由处，使用Illuminate\Http\Request实体
Route::get('user/{id}', function(Request $request, $id){
    if ($request->route('id')){
        //$request->route('id')的值等于$id的值
    }
});
```

##路由命名

```php
Route::get('user/profile', ['as' => 'profile', function(){
    //以profile来命名user/profile
}]);

// 指定控制器
Route::get('user/profile', [
    'as' => 'profile', 'uses' => 'UserController@showProfile'
]);

// 命名后的使用，可以用在其他控制器中生成url或重定向
$url = route('profile');
$redirect = redirect()->route('profile');

// 获取当前路由器的名称
$name = Route::currentRouteName();
```

##路由群组
为多个路由统一设置URL区段、中间件及命名空间等属性。将要设置的共享属性，作为数组的一个元素传进group的第一个参数。

```php
// 中间件，会按照定义的顺序执行
Route::group(['middleware' => ['foo', 'bar']], function(){
    Route::get('/', function(){
        // Has Foo And Bar Middleware
    });

    Route::get('user/profile', function(){
        // Has Foo And Bar Middleware
    });

});

// 命名空间
Route::group(['namespace' => 'Admin'], function(){
    // Controllers Within The "App\Http\Controllers\Admin" Namespace

    Route::group(['namespace' => 'User'], function(){
        // Controllers Within The "App\Http\Controllers\Admin\User" Namespace
    });
});

//注意： 在默认情况下，RouteServiceProvider 包含内置您命名空间群组的 routes.php 文件，让您不须使用完整的 App\Http\Controllers 命名空间前缀就可以注册控制器路由。


// 路由前缀prefix
Route::group(['prefix' => 'admin'], function(){
    Route::get('users', function(){
        // Matches The "/admin/users" URL
    });
});

// 带参数的路由前缀
Route::group(['prefix' => 'accounts/{account_id}'], function(){
    Route::get('detail', function($account_id){
        // Matches The "/accounts/{account_id}/detail" URL
    });
});


// 限制路由前缀参数的格式
Route::group([
    'prefix' => 'accounts/{account_id}',
    'where' => ['account_id' => '[0-9]+'],
], function() {

    // Define Routes Here
});
```


获取路由的url，$url = url('foo');

CSRF(跨网站请求伪造)保护
Lavavel会为每个用户session创建一个唯一的token，可以将这个token添加到表单中来验证用户的真实性。HTTP中间件中会对session中的token进行验证，不用需要开发者手动验证。

```php
// 将csrftoken添加到表单
<input type="hidden" name="_token" value="<?php echo csrf_token(); ?>">
//  Blade 模板引擎中的用法
<input type="hidden" name="_token" value="{{ csrf_token() }}">
```

在ajax中使用

```php
// meta中加载
<meta name="csrf-token" content="{{ csrf_token() }}" />
// 加入jQuery请求头，加入后jq的ajax()会默认带上token
$.ajaxSetup({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
});
```


