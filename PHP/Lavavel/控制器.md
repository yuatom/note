# 控制器
##基础控制器定义
定义，app/Http/Controllers中：
注意： 所有的控制器都应该扩展基础控制器类。

```php
<?php namespace App\Http\Controllers;

use App\Http\Controllers\Controller;

class UserController extends Controller {

    /**
     * 显示所给定的用户个人数据。
     *
     * @param  int  $id
     * @return Response
     */
    public function showProfile($id) {
        return view('user.profile', ['user' => User::findOrFail($id)]);
    }

}
```

配置，app/Http/routes.php中

```php
// 基础
Route::get('user/{id}', 'UserController@showProfile');

// 命名控制器路由
Route::get('foo', ['uses' => 'FooController@method', 'as' => 'name']);
```

###命名空间
routes.php中默认的控制命名空间为根命名空间App\Http\Controllers，RouteServiceProvider 默认会在包含根控制器命名空间的路由群组中，加载 routes.php 此文件。因此不需要在routes.php中指定控制器的命名空间。
如果要使用App\Http\Controllers下更深层级的命名空间的控制器时，只需要使用相对于App\Http\Controllers的类名称即可：

```php
// App\Http\Controllers\Photos\AdminController
Route::get('foo', 'Photos\AdminController@method');
```

###产生执行控制器action的url

```php
// 完整命名空间
$url = action('App\Http\Controllers\FooController@method');

// 先设置命名空间
URL::setRootControllerNamespace('App\Http\Controllers');
$url = action('FooController@method');

// 获取当前的url
$action = Route::currentRouteAction();
```

##控制器中间件

```php
// 在控制器路由中指定
Route::get('profile', [
    'middleware' => 'auth',
    'uses' => 'UserController@showProfile'
]);


// 在控制器构造器中指定中间件 ：
class UserController extends Controller {

    /**
     * 建立一个新的 UserController 实例。
     */
    public function __construct()
    {
        $this->middleware('auth');

        $this->middleware('log', ['only' => ['fooAction', 'barAction']]);

        $this->middleware('subscribed', ['except' => ['fooAction', 'barAction']]);
    }

}
```

##隐式控制器
使用单一路由来处理控制器中每一个action:
>* 在routes.php中配置

```php
// 该方法接收两个参数
// 第一个参数是控制器的base url
// 第二个参数是控制器的类名称
Route::controller('users', 'UserController');
```

>* 定义控制器

```php
class UserController extends Controller {
	
    public function getIndex() {
        // index action会处理根url，即host/index.php/users
    }

    public function postProfile() {
        //
    }

    public function anyLogin() {
        //
    }
    
    public function getAdminProfile() {
    		// 控制器行为包含多个字词，你可以在 URI 中使用「破折号」语法来访问此行为
    		// 该方法会相应users/admin-profile
    }

}
```

>* 命名控制器的路由，如果需要命名控制器的名称

```php
Route::controller('users', 'UserController', [
    'anyLogin' => 'user.login',
]);
```

##RESTful 资源控制器
可使用artisan快速地创建资源控制器：

```shell
php artisan make:controller PhotoController
```
然后注册一个路由

```php
Route::resource('photo', 'PhotoController');
```

###资源控制器处理的行为
| 动词	| 路径	| 行为	| 路由名称 | 


| GET	| /photo  	| 索引	| photo.index | 
| GET	| /photo/create	| 创建	| photo.create | 
| POST	| /photo	| 保存	| photo.store | 
| GET	| /photo/{photo}	| 显示	| photo.show | 
| GET	| /photo/{photo}/edit	| 编辑	| photo.edit | 
| PUT/PATCH	| /photo/{photo}	| 更新	| photo.update | 
| DELETE	| /photo/{photo}	| 删除	| photo.destroy | 

###自定义路由

```php
Route::resource('photo', 'PhotoController',
                ['only' => ['index', 'show']]);

Route::resource('photo', 'PhotoController',
                ['except' => ['create', 'store', 'update', 'destroy']]);

// 自定义路由名称                
Route::resource('photo', 'PhotoController',
                ['names' => ['create' => 'photo.build']]);
```

###嵌套路由

```php
// 路由声明中使用「点」号来「嵌套化」资源控制器：
Route::resource('photos.comments', 'PhotoCommentController');

// 可透过像 photos/{photos}/comments/{comments} 这样的 URL 来访问
class PhotoCommentController extends Controller {

    /**
     * 显示指定照片的评论。
     *
     * @param  int  $photoId
     * @param  int  $commentId
     * @return Response
     */
    public function show($photoId, $commentId) {
        //
    }

}
```

###加入其他路由

```php
// 默认的资源路由外，若你还需要在资源控制器中加入其他路由
// 应该在调用 Route::resource 之前先定义它们
Route::get('photos/popular', 'PhotoController@method');
Route::resource('photos', 'PhotoController');
```

##依赖注入和控制器
###构造器注入
Laravel会解析所有的控制器，如果某个控制器的构造函数需要某些依赖（传入参数）时，Laravel容器会去解析并创建这个依赖：

```
php
<?php namespace App\Http\Controllers;

use Illuminate\Routing\Controller;
use App\Repositories\UserRepository;

class UserController extends Controller {

    /**
     * 用户保存库实例。
     */
    protected $users;

    /**
     * 创建新的控制器实例。
     *
     * @param  UserRepository  $users
     * @return void
     */
    public function __construct(UserRepository $users) {
        $this->users = $users;
    }

}
```

###方法注入
同样的，当控制器的方法也有依赖时，容器也会去解析并注入依赖：

```php
<?php namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Routing\Controller;

class UserController extends Controller {

    /**
     * 保存一个新的用户。
     *
     * @param  Request  $request
     * @return Response
     */
    public function store(Request $request) { // 该方法需要传入Request
        $name = $request->input('name');
        // 
    }
    
    
    /**
     * 更新一个特定的用户。
     *
     * @param  Request  $request
     * @param  int  $id
     * @return Response
     */
    public function update(Request $request, $id){	// 该方法由路由参数取得输入
        //
    }

}
```

##路由缓存
若您的应用只使用了控制器路由，你可利用 Laravel 的路由缓存。使用路由缓存，将大幅降低注册应用程序所有路由所需要的时间。某些情况下，路由注册甚至可以快上 100 倍。要产生路由缓存，只要执行 route:cache Artisan 命令：

```shell
php artisan route:cache
```

缓存路由文件将会被用来代替 app/Http/routes.php 此一文件。记住，若你增加了任何新的路由，你就 必须产生一个新的路由缓存。因此在应用部署时，你可能会希望只要执行 route:cache 命令：

要移除路由缓存文件，但不希望产生新的缓存，可使用 route:clear 命令：

```shell
php artisan route:clear
```




产生url
url()
route()
action()

