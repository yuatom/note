# 事件模块
##事件机制

##结构体

```c
// 事件模块的通用接口
typedef struct {
    ngx_str_t           *name;
    void                *(*create_conf)(ngx_cycle_t *cycle);
    char                *(*init_conf)(ngx_cycle_t *cycle, void *conf);
    
    //定义了IO模型(epoll, poll, select)的各种抽象接口
    ngx_event_actions_t     actions;    
} ngx_event_module_t;


/* 事件结构体 */

```

##module定义

```c
// 事件的配置指令集
static ngx_command_t ngx_events_commands[] = {
    {
        ngx_string("events"),
        NGX_MAIN_CONF|NGX_CONF_BLOCK|NGX_CONF_NOARG,
        ngx_events_block,
        0,
        0,
        NULL
    },
    ngx_null_command
}
/* 
 * Nginx在解析配置文件中的一个配置项时首先会遍历所有的模块，对于每一个模块而言，会遍历
 * commands数组，此外，在数组中检查到ngx_null_command时，会停止当前模块解析该配置
 * nginx_null_command的定义
 * define ngx_null_command {ngx_null_string, 0, NULL, 0, 0, NUll } 
 */

// 事件的上下文，需要实现核心模块的共同接口ngx_core_module_t
static ngx_core_module_t ngx_events_module_ctx = {
    ngx_string("events"),
    NULL,
    NULL
};

/* ngx_events_module */
ngx_module_t ngx_events_module = {
    NGX_MODULE_V1,
    &ngx_events_module_ctx, // 上下文
    ngx_events_commands,    // 指令集
    NGX_CORE_MODULE,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NGX_MODULE_V1_PADDING
};

/* ngx_event_core_module */
ngx_module_t ngx_event_core_module = {
    NGX_MODULE_V1,
    &ngx_events_core_module_ctx,
    ngx_events_commands,
    NGX_CORE_MODULE,
    NULL,
    ngx_event_module_init,  /* module init */
    ngx_event_process_init,
    NULL,
    NULL,
    NULL,
    NULL,
    NGX_MODULE_V1_PADDING
}

```

ngx_event_actions_t，事件驱动机制，ngx_event_module_t中会有一个该结构体的actions成员，该结构体中定义了10个抽象方法，


惊群问题——通过强锁解决

